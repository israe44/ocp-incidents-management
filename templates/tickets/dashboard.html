<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard - OCP Incidents</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-950 text-white">
  <header class="border-b border-white/10 bg-white/5">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <div>
        <h1 class="text-xl font-semibold">OCP Incidents</h1>
        <p class="text-white/60 text-sm">Dashboard</p>
      </div>

      <div class="flex items-center gap-3">
        <div class="text-right">
          <div class="text-sm font-medium">{{ request.user.username }}</div>
          <div class="text-xs text-white/60">{{ request.user.role }}</div>
        </div>
        <a href="{% url 'analytics' %}" class="px-3 py-2 rounded-xl bg-purple-600 hover:bg-purple-500 border border-purple-500 text-sm">
          ðŸ“Š Analytics
        </a>
        <a href="{% url 'board' %}" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10 text-sm">
          Board
        </a>
        <a href="{% url 'logout' %}" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10 text-sm">
          Logout
        </a>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-6">
    
    <!-- Summary Stats -->
    <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-6">
      <div class="rounded-xl bg-white/5 border border-white/10 p-3">
        <div class="text-white/60 text-xs mb-1">Total</div>
        <div class="text-xl font-bold">{{ summary.total }}</div>
      </div>
      <div class="rounded-xl bg-blue-600/20 border border-blue-500/30 p-3">
        <div class="text-blue-200 text-xs mb-1">New</div>
        <div class="text-xl font-bold text-blue-300">{{ summary.new }}</div>
      </div>
      <div class="rounded-xl bg-yellow-600/20 border border-yellow-500/30 p-3">
        <div class="text-yellow-200 text-xs mb-1">In Progress</div>
        <div class="text-xl font-bold text-yellow-300">{{ summary.in_progress }}</div>
      </div>
      <div class="rounded-xl bg-green-600/20 border border-green-500/30 p-3">
        <div class="text-green-200 text-xs mb-1">Resolved</div>
        <div class="text-xl font-bold text-green-300">{{ summary.resolved }}</div>
      </div>
      <div class="rounded-xl bg-red-600/20 border border-red-500/30 p-3">
        <div class="text-red-200 text-xs mb-1">Critical</div>
        <div class="text-xl font-bold text-red-300">{{ summary.critical }}</div>
      </div>
      <div class="rounded-xl bg-orange-600/20 border border-orange-500/30 p-3">
        <div class="text-orange-200 text-xs mb-1">Overdue</div>
        <div class="text-xl font-bold text-orange-300">{{ summary.overdue }}</div>
      </div>
    </div>

    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">Tickets</h2>

      {% if request.user.role != "technician" %}
        <a href="{% url 'ticket_create' %}" class="px-4 py-2 rounded-xl bg-blue-600 hover:bg-blue-500 text-sm font-medium">
          + New Ticket
        </a>
      {% endif %}
    </div>

    <form class="flex flex-wrap gap-2 mb-4" method="GET">

      <input name="search" value="{{ search|default:'' }}"
             placeholder="Search title..."
             class="rounded-xl bg-slate-900 border border-white/10 px-3 py-2 text-sm" />

      <select name="status" class="rounded-xl bg-slate-900 border border-white/10 px-3 py-2 text-sm">
        <option value="">All status</option>
        <option value="NEW" {% if status == "NEW" %}selected{% endif %}>NEW</option>
        <option value="IN_PROGRESS" {% if status == "IN_PROGRESS" %}selected{% endif %}>IN_PROGRESS</option>
        <option value="RESOLVED" {% if status == "RESOLVED" %}selected{% endif %}>RESOLVED</option>
        <option value="CLOSED" {% if status == "CLOSED" %}selected{% endif %}>CLOSED</option>
      </select>

      <select name="urgency" class="rounded-xl bg-slate-900 border border-white/10 px-3 py-2 text-sm">
        <option value="">All urgency</option>
        <option value="LOW" {% if urgency == "LOW" %}selected{% endif %}>LOW</option>
        <option value="MEDIUM" {% if urgency == "MEDIUM" %}selected{% endif %}>MEDIUM</option>
        <option value="HIGH" {% if urgency == "HIGH" %}selected{% endif %}>HIGH</option>
        <option value="CRITICAL" {% if urgency == "CRITICAL" %}selected{% endif %}>CRITICAL</option>
      </select>

      <button class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 text-sm">
        Filter
      </button>

    </form>

    <div class="grid gap-3">
      {% if tickets %}
        {% for t in tickets %}
          <a href="{% url 'ticket_detail' t.id %}"
             class="block rounded-2xl bg-white/5 border border-white/10 p-4 hover:bg-white/10 transition">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="font-semibold">#{{ t.id }} â€” {{ t.title }}</div>
                <div class="text-sm text-white/60 mt-1">
                  Urgency: <span class="text-white">{{ t.urgency }}</span> Â·
                  Status: <span class="text-white">{{ t.status }}</span>
                </div>
                <div class="text-xs text-white/50 mt-2">
                  Created by: {{ t.created_by.username }}
                  {% if t.assigned_to %} Â· Assigned to: {{ t.assigned_to.username }}{% endif %}
                </div>
              </div>

              <div class="text-xs text-white/50 text-right">
                <div>Created: {{ t.created_at|date:"Y-m-d H:i" }}</div>
                <div>Updated: {{ t.updated_at|date:"Y-m-d H:i" }}</div>
              </div>
            </div>
          </a>
        {% endfor %}
      {% else %}
        <div class="rounded-2xl bg-white/5 border border-white/10 p-6 text-white/70">
          No tickets found for your account.
        </div>
      {% endif %}
    </div>
  </main>
</body>
</html>
